<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Child Profile</title>
<style>
body{
  margin:0;
  font-family:Arial,sans-serif;
  background:linear-gradient(135deg,#1b1e24,#3b3f47);
  color:white;
}

.back-btn{
  display:inline-block;
  margin:20px;
  padding:10px 18px;
  background:rgba(255,255,255,0.15);
  color:white;
  text-decoration:none;
  border-radius:8px;
}
.back-btn:hover{background:rgba(255,255,255,0.3);}

/* 3-column layout on larger screens, stacks on mobile */
.profile-row{
  width:90%;
  max-width:1200px;
  margin:10px auto 30px auto;
  display:grid;
  grid-template-columns:1fr 2fr 1fr; /* child | bio | spouse */
  gap:20px;
}

/* side cards */
.side-card{
  background:rgba(255,255,255,0.12);
  border-radius:16px;
  padding:15px;
  text-align:center;
  border:2px solid #e91a63;
  box-sizing:border-box;
}
.side-card img{
  width:100%;
  height:260px;
  object-fit:cover;
  border-radius:12px;
  display:block;
}

/* bio in the center */
.bio-card{
  background:rgba(255,255,255,0.1);
  border-radius:16px;
  padding:20px;
  border:2px solid #ffd9b3;
  box-sizing:border-box;
}
.bio-card h2{
  margin-top:0;
  font-size:24px;
}
.bio-card p{
  font-size:15px;
  line-height:1.6;
  margin:8px 0;
}

/* children grid/cards */
.section-title{
  text-align:center;
  margin:20px 0 10px;
  color:#ffd9b3;
  font-size:22px;
}

.children-grid{
  width:90%;
  max-width:1300px;
  margin:0 auto 40px auto;
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:18px;
}

.child-card{
  background:rgba(255,255,255,0.13);
  border-radius:18px;
  padding:14px;
  text-align:center;
  border:2px solid #1a73e8;
  transition:0.3s;
  box-sizing:border-box;
  cursor:pointer;
}
.child-card:hover{
  transform:translateY(-4px);
}
.child-card.late{
  opacity:0.6;
}

.child-card img{
  width:100%;
  height:220px;
  object-fit:cover;
  border-radius:14px;
  display:block;
}
.child-card h4{
  margin:10px 0 4px;
  font-size:16px;
  color:#ffe6c6;
}
.child-card p{
  margin:2px 0;
  font-size:13px;
  color:#ffd9b3;
}

/* TABLETS + MOBILE */
@media (max-width: 768px){
  .profile-row{
    grid-template-columns:1fr;
    gap:15px;
  }
  .side-card img{
    height:220px;
  }
  .bio-card{
    padding:16px;
  }
  .bio-card h2{
    font-size:20px;
  }
  .bio-card p{
    font-size:14px;
  }
  .section-title{
    font-size:20px;
    margin:15px 0 8px;
  }
  .children-grid{
    gap:14px;
    grid-template-columns:repeat(auto-fit,minmax(170px,1fr));
  }
  .child-card{
    padding:12px;
  }
  .child-card img{
    height:200px;
  }
  .child-card h4{
    font-size:15px;
  }
  .child-card p{
    font-size:12px;
  }
}

/* VERY SMALL PHONES */
@media (max-width: 480px){
  body{
    font-size:14px;
  }
  .profile-row,
  .children-grid{
    width:95%;
    margin:10px auto 25px auto;
  }
}

/* ===== MODAL STYLES ===== */
.modal{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.7);
  justify-content:center;
  align-items:center;
  z-index:1000;
}
.modal-content{
  background:#111827;
  padding:20px;
  border-radius:12px;
  max-width:600px;
  width:90%;
  color:#fff;
}
.modal-images{
  display:flex;
  gap:16px;
  margin:10px 0 15px;
}
.modal-images img{
  width:100%;
  max-width:200px;
  border-radius:10px;
  object-fit:cover;
}
.modal .close{
  float:right;
  font-size:24px;
  cursor:pointer;
}
@media(max-width:600px){
  .modal-images{
    flex-direction:column;
  }
}
</style>
</head>
<body>

<a href="javascript:history.back()" class="back-btn">← Back</a>

<div class="profile-row">
  <div class="side-card">
    <img id="personImg" src="images/placeholder.jpg" alt="">
    <h3 id="personName"></h3>
  </div>

  <div class="bio-card">
    <h2>Biography</h2>
    <p id="bio1"></p>
    <p id="bio2"></p>
    <p id="bio3"></p>
  </div>

  <div class="side-card" id="spouseCard"></div>
</div>

<h2 class="section-title">Children</h2>
<div class="children-grid" id="childrenGrid"></div>

<!-- ===== GRANDCHILD MODAL ===== -->
<div id="grandchildModal" class="modal">
  <div class="modal-content">
    <span class="close">&times;</span>

    <h3 id="gcName"></h3>

    <div class="modal-images">
      <div>
        <img id="gcImg" src="" alt="">
        <p id="gcNameSmall"></p>
      </div>
      <div>
        <img id="spouseImg" src="" alt="">
        <p id="spouseName"></p>
      </div>
    </div>

    <h4>Children</h4>
    <ul id="gcChildrenList"></ul>
  </div>
</div>

<script>
// ===== READ wives DATA SAVED IN LOCALSTORAGE =====
const wives = JSON.parse(localStorage.getItem("wivesData"));

const params = new URLSearchParams(window.location.search);
let id = parseInt(params.get("id"), 10);
let cid = parseInt(params.get("cid"), 10);

if (!wives || !Array.isArray(wives)) {
  document.body.innerHTML = "<h2 style='text-align:center;'>Data not found</h2>";
  throw new Error("wivesData missing");
}

if (!id || id < 1 || id > wives.length) id = 1;
const wid = id - 1;

if (!wives[wid] || !wives[wid].children || !wives[wid].children[cid]) {
  document.body.innerHTML = "<h2 style='text-align:center;'>Child not found</h2>";
  throw new Error("Invalid wid/cid");
}

const child = wives[wid].children[cid];

// ===== FILL CHILD INFO =====
document.getElementById("personName").textContent = child.name || "";
document.getElementById("personImg").src =
  child.img || "images/placeholder.jpg";

document.getElementById("bio1").textContent = child.bio?.[0] || "";
document.getElementById("bio2").textContent = child.bio?.[1] || "";
document.getElementById("bio3").textContent = child.bio?.[2] || "";

// ===== SPOUSE CARD =====
document.getElementById("spouseCard").innerHTML = `
  <img src="${child.spouseImg || 'images/placeholder.jpg'}" alt="">
  <h3>${child.spouse || "—"}</h3>
`;

// ===== AGE CALC =====
function calculateAge(dob){
  if(!dob) return "";
  const birth = new Date(dob);
  if (isNaN(birth)) return "";
  const today = new Date();
  let age = today.getFullYear() - birth.getFullYear();
  const m = today.getMonth() - birth.getMonth();
  if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) {
    age--;
  }
  return age;
}

// ===== CHILDREN GRID (grandchildren) =====
const grid = document.getElementById("childrenGrid");
grid.innerHTML = "";

let grandchildren = [];

if (Array.isArray(child.children)) {
  grandchildren = child.children;
  grandchildren.forEach((c, index) => {
    const age = calculateAge(c.dob);
    const card = document.createElement("div");
    card.className = "child-card " + (c.late ? "late" : "");
    card.innerHTML = `
      <img src="${c.img || 'images/placeholder.jpg'}" alt="">
      <h4>${c.name}</h4>
      ${c.dob ? `<p>DOB: ${c.dob}</p>` : ""}
      ${age !== "" ? `<p>Age: ${age} years</p>` : ""}
    `;
    card.dataset.index = index; // for modal
    grid.appendChild(card);
  });
} else {
  const alive = (child.childrenCount || 0) - (child.late || 0);
  for (let i = 1; i <= alive; i++) {
    const card = document.createElement("div");
    card.className = "child-card";
    card.innerHTML = `
      <img src="images/placeholder.jpg" alt="">
      <h4>Child ${i}</h4>
    `;
    grid.appendChild(card);
  }
  for (let i = 1; i <= (child.late || 0); i++) {
    const card = document.createElement("div");
    card.className = "child-card late";
    card.innerHTML = `
      <img src="images/placeholder.jpg" alt="">
      <h4>Late Child</h4>
    `;
    grid.appendChild(card);
  }
}

// ===== MODAL LOGIC =====
const modal = document.getElementById("grandchildModal");
const closeBtn = modal.querySelector(".close");
const gcName = document.getElementById("gcName");
const gcNameSmall = document.getElementById("gcNameSmall");
const spouseName = document.getElementById("spouseName");
const gcImg = document.getElementById("gcImg");
const spouseImg = document.getElementById("spouseImg");
const gcChildrenList = document.getElementById("gcChildrenList");

// click on any child card to open popup
grid.addEventListener("click", (e) => {
  const card = e.target.closest(".child-card");
  if (!card) return;

  const index = parseInt(card.dataset.index, 10);
  const gc = grandchildren[index];
  if (!gc) return;

  gcName.textContent = gc.name || "";
  gcNameSmall.textContent = gc.name || "";
  gcImg.src = gc.img || "images/placeholder.jpg";
  spouseName.textContent = gc.spouse || "Spouse";
  spouseImg.src = gc.spouseImg || "images/placeholder.jpg";

  // if in future you add gc.children, they will appear here
  gcChildrenList.innerHTML = "";
  const kids = Array.isArray(gc.children) ? gc.children : [];
  kids.forEach(k => {
    const li = document.createElement("li");
    li.textContent = `${k.name} ${k.dob ? "(" + k.dob + ")" : ""}`;
    gcChildrenList.appendChild(li);
  });

  modal.style.display = "flex";
});

closeBtn.addEventListener("click", () => {
  modal.style.display = "none";
});

window.addEventListener("click", (e) => {
  if (e.target === modal) modal.style.display = "none";
});
</script>

</body>
</html>